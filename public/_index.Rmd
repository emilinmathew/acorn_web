---
title: "Environmental and Structural Drivers of Acorn Production in Coast Live Oak"
authors: "Emilin Mathew"
output: html_document
---

![Team Purple](/images/jasper.png)

# Abstract
Acorn production in Quercus agrifolia (Coast Live Oak) is influenced by multiple environmental and structural factors, yet the extent of these influences remains unclear. We hypothesized that (1) the south-facing sides of trees would produce more acorns due to greater sunlight exposure, (2) trees with larger diameters at breast height (DBH) and greater crown diameters would have higher acorn production, and (3) acorn yield would decrease with lower vegetation density. We measured acorn production using quadrat sampling, analyzed the tree's structural attributes, and assessed vegetation density through the Normalized Difference Vegetation Index (NDVI). Our results indicated weak correlations between acorn yield and all tested variables, with p-values exceeding 0.05 and low R² values, suggesting these factors do not significantly correlate to acorn production. The findings highlight the complexity of acorn yield dynamics, likely influenced by unmeasured factors such as genetic variability, soil composition, and masting cycles. Future research with larger sample sizes and refined environmental metrics is needed to improve predictive models. These insights contribute to oak conservation efforts and understanding of acorn availability for wildlife.

# Methods
## Study Area
This study was conducted at Jasper Ridge Biological Preserve (‘Ootchamin ‘Ooyakma), a protected ecological research site in the eastern foothills of the Santa Cruz Mountains in Woodside, California (Figure 1). The preserve spans approximately 1,198 acres and has various habitats, including oak woodlands, chaparral, and grasslands. The Mediterranean climate in the preserve also provides natural variations in sunlight exposure, soil moisture, and vegetation density, making it an ideal location to assess the environmental and structural drivers of acorn production. 

## Data Collection
We collected data from 16 mature coast live oak trees within the preserve in January of Winter 2024 and 2025. These trees were healthy, free from major diseases, and of varying sizes. The structural measurements we took from each tree were diameter at breast height (DBH), crown diameters, and canopy exposures. DBH was measured at 1.4 m above the ground using diameter tape. The DBH of the three largest trunks was recorded for trees with multiple trunks, and one final DBH was taken from such trees by taking the square root of the sum of all three DBHs. We measured two central diameters: (1) the diameter of the maximum axis and (2) the axis perpendicular to the maximum axis. We acquired acorn production measurements using the quadrat method. The quadrats, which measured 62cm x 62cm, were placed in each cardinal direction of the focal tree, ensuring that the quadrat was aligned to the edge of the tree crown. Only acorn caps within the quadrats were counted and incorporated into the dataset to prevent double counting. Additionally, we incorporated the Normalized Difference Vegetation Index (NDVI) from the Sentinel-2 satellite for the 2024 and 2025 winter seasons to obtain vegetation density near our 16 trees. 

## Data Analysis
To assess the impact of cardinal direction on acorn production, we ran a paired t-test to compare the difference between acorn production on the north and south sides of the trees; we controlled for year-to-year variation by using a linear mixed-effects model to account for both fixed, such as the year, and random effects. We used simple linear regression to understand correlations between the DBH or crown diameter and acorn production. We then incorporated these findings into a multiple linear regression to assess the impact of DBH and crown diameter on acorn production. Additionally, we analyzed the impact of vegetation density on acorn production using simple linear regression and a linear mixed-effects model to account for both fixed and random effects. 


# Overview of Results
Acorn production across 2024 and 2025 demonstrated minimal correlations with tree size metrics, NDVI index, and regional grouping. Box plots of acorn count across groups showed no statistically significant differences between each tree's North and South regions, with all p-values exceeding 0.1. Analysis of tree size metrics, including DBH and crown diameters, revealed weak correlations with total acorn production, with R² values below 0.07 and p-values consistently above 0.3. Similarly, 3D regression analysis of acorn production against DBH and average crown diameter in 2024 and 2025 indicated weak explanatory power (R² = 0.073 and 0.07, respectively), emphasizing the limited predictive utility of these variables. Finally, the relationship between acorn production and the NDVI across 2024, 2025, and combined years also demonstrated minimal correlation, with low R² values (0.005 to 0.045) and high p-values (p > 0.4). 

## Relationship Between Cardinal Direction & Acorn Production
```{r setupp, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
# Load required libraries
library(ggplot2)
library(showtext)
library(gridExtra)
font_add_google("Lato", "lato")
showtext_auto()


# Hard-coded data for 2024 and 2025 including zeros
north_2024 <- c(13, 0, 1, 0, 1, 23, 1, 11, 0, 2, 69, 9, 0, 0, 0, 1)
south_2024 <- c(11, 16, 2, 11, 1, 37, 0, 36, 0, 6, 41, 72, 1, 0, 0, 8)
north_2025 <- c(50, 8, 42, 23, 13, 231, 2, 209, 5, 26, 145, 18, 18, 12, 7, 12)
south_2025 <- c(118, 66, 6, 14, 5, 390, 5, 202, 6, 62, 57, 12, 16, 17, 2, 21)
# Combined data
combined_north <- c(north_2024, north_2025)
combined_south <- c(south_2024, south_2025)
# Perform T-tests
t_test_2024 <- t.test(north_2024, south_2024, alternative = "two.sided", var.equal = FALSE)
t_test_2025 <- t.test(north_2025, south_2025, alternative = "two.sided", var.equal = FALSE)
t_test_combined <- t.test(combined_north, combined_south, alternative = "two.sided", var.equal = FALSE)
# Display t-test results
t_test_results <- data.frame(
  Year = c("2024", "2025", "Combined"),
  T_value = c(round(t_test_2024$statistic, 3), round(t_test_2025$statistic, 3), round(t_test_combined$statistic, 3)),
  P_value = c(round(t_test_2024$p.value, 3), round(t_test_2025$p.value, 3), round(t_test_combined$p.value, 3)),
  Mean_North = c(round(mean(north_2024), 1), round(mean(north_2025), 1), round(mean(combined_north), 1)),
  Mean_South = c(round(mean(south_2024), 1), round(mean(south_2025), 1), round(mean(combined_south), 1))
)

# Prepare data in long format for ggplot
df_long <- data.frame(
  Quadrat = rep(c("North", "South"), each = 32),
  Acorn_Count = c(north_2024, south_2024, north_2025, south_2025),
  Year = rep(c("2024", "2024", "2025", "2025"), each = 16)
)
```

```{r plot-card}
# Function to create a single combined boxplot with all years
ggplot(df_long, aes(x = interaction(Year, Quadrat), y = Acorn_Count, fill = Quadrat)) +
  geom_boxplot(outlier.shape = 21, outlier.color = "black", outlier.fill = "white", alpha = 0.7, 
               notch = TRUE, width = 0.6, fatten = 1.5) +
  geom_jitter(color = "black", width = 0.3, size = 3, alpha = 0.8) +
  stat_summary(fun = "mean", geom = "point", shape = 18, size = 3, color = "black") +
  scale_fill_manual(values = c("North" = "#0073C2", "South" = "#E74C3C")) +
  labs(x = "Year & Quadrat", y = "Acorn Count", title = "Acorn Count Comparison by Year and Quadrat") +
  theme_minimal(base_size = 14) +
  theme(
    axis.title = element_text(size = 16, family = "lato"),
    axis.text = element_text(size = 14, family = "lato"),
    panel.grid.major = element_line(color = "gray90"),
    panel.grid.minor = element_blank(),
    text = element_text(family = "lato")
  )

```

## Relationship Between NDVI and Acorn Production
This analysis examines the relationship between NDVI (Normalized Difference Vegetation Index) and acorn production across two years (2024 and 2025).

```{r setup, include=FALSE}
# Load necessary libraries
library(dplyr)
library(ggplot2)
library(lmerTest)
library(tidyr)
library(MuMIn)
library(broom.mixed)

# Set global chunk options to hide code
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

# Load the data from CSV files
ndvi_2024 <- read.csv(here::here("static", "Tree_NDVI_Values_2024.csv"))
ndvi_2025 <- read.csv(here::here("static", "Tree_NDVI_Values_2025.csv"))
acorn_2024 <- read.csv(here::here("static", "2024_acorn.csv"))
acorn_2025 <- read.csv(here::here("static", "2025_acorn.csv"))

# Rename columns to distinguish years
data_2024 <- acorn_2024 %>%
  rename(sum_acorns_2024 = sum_acorns)

data_2025 <- acorn_2025 %>%
  rename(sum_acorns_2025 = acorn_sum)

# Merge datasets on TreeID
merged_data <- merge(data_2024, data_2025, by = "TreeID")
merged_data <- merge(merged_data, ndvi_2024, by = "TreeID")
merged_data <- merge(merged_data, ndvi_2025, by = "TreeID")

# Model 1: NDVI in 2024 predicting Acorn count in 2024
model_2024 <- lm(sum_acorns_2024 ~ NDVI_2024, data = merged_data)
summary_2024 <- summary(model_2024)
r2_2024 <- round(summary_2024$r.squared, 3)
p_value_2024 <- round(summary_2024$coefficients[2,4], 3)

# Model 2: NDVI in 2025 predicting Acorn count in 2025
model_2025 <- lm(sum_acorns_2025 ~ NDVI_2025, data = merged_data)
summary_2025 <- summary(model_2025)
r2_2025 <- round(summary_2025$r.squared, 3)
p_value_2025 <- round(summary_2025$coefficients[2,4], 3)

# Reshape data into long format for mixed model
long_data <- merged_data %>%
  pivot_longer(cols = c(sum_acorns_2024, sum_acorns_2025, NDVI_2024, NDVI_2025),
               names_to = c(".value", "Year"),
               names_pattern = "(.*)_(\\d{4})")

# Convert Year to a factor
long_data$Year <- as.factor(long_data$Year)

# Fit a mixed-effects model
model_mixed <- lmer(sum_acorns ~ NDVI + (1 | Year) + (1 | TreeID), data = long_data)

# Extract model statistics
summary_mixed <- summary(model_mixed)
r2_mixed <- round(r.squaredGLMM(model_mixed)[1], 3)  # Marginal R² (fixed effects only)
p_value_mixed <- round(coef(summary(model_mixed))["NDVI", "Pr(>|t|)"], 3)
```

### NDVI vs Acorn Production (2024)

```{r plot-2024}
ggplot(merged_data, aes(x = NDVI_2024, y = sum_acorns_2024)) +
  geom_point(color = "blue") +
  geom_smooth(method = "lm", color = "red") +
  labs(title = "NDVI vs Acorn Production (2024)", 
       x = "NDVI Index (2024)", 
       y = "Acorn Production (Caps/Quadrant, 2024)") +
  theme_minimal() +
  annotate("text", x = max(merged_data$NDVI_2024, na.rm = TRUE) * 0.95, 
           y = max(merged_data$sum_acorns_2024, na.rm = TRUE) * 0.95, 
           label = paste0("R² = ", r2_2024, "\n p = ", p_value_2024),
           hjust = 1, size = 5)
```

### NDVI vs Acorn Production (2025)

```{r plot-2025}
ggplot(merged_data, aes(x = NDVI_2025, y = sum_acorns_2025)) +
  geom_point(color = "blue") +
  geom_smooth(method = "lm", color = "red") +
  labs(title = "NDVI vs Acorn Production (2025)", 
       x = "NDVI Index (2025)", 
       y = "Acorn Production (Caps/Quadrant, 2025)") +
  theme_minimal() +
  annotate("text", x = max(merged_data$NDVI_2025, na.rm = TRUE) * 0.95, 
           y = max(merged_data$sum_acorns_2025, na.rm = TRUE) * 0.95, 
           label = paste0("R² = ", r2_2025, "\n p = ", p_value_2025),
           hjust = 1, size = 5)
```

### Combined Analysis (2024 & 2025)

```{r plot-combined}
ggplot(long_data, aes(x = NDVI, y = sum_acorns, color = Year)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", se = TRUE) +
  labs(title = "NDVI vs. Acorn Production (2024 & 2025)", 
       x = "NDVI Index", 
       y = "Acorn Production (Caps/Quadrant)") +
  theme_minimal() +
  scale_color_manual(values = c("2024" = "blue", "2025" = "red")) +
  annotate("text", x = max(long_data$NDVI, na.rm = TRUE) * 0.95, 
           y = max(long_data$sum_acorns, na.rm = TRUE) * 0.95, 
           label = paste0("R² = ", r2_mixed, "\n p = ", p_value_mixed),
           hjust = 1, color = "black", size = 5)
```

### Statistical Summary

```{r stats-summary}
cat("2024 Model: R² =", r2_2024, ", p-value =", p_value_2024, "\n")
cat("2025 Model: R² =", r2_2025, ", p-value =", p_value_2025, "\n")
cat("Combined Mixed Model: R² =", r2_mixed, ", p-value =", p_value_mixed, "\n")
```